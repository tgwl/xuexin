<template>
  <div class="about-guide-page">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <van-nav-bar title="å…³äºä¸ä½¿ç”¨" left-arrow @click-left="goBack" fixed />

    <div class="content">
      <!-- åº”ç”¨ä¿¡æ¯ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
      <div class="card app-card">
        <div class="app-header">
          <div class="app-icon">ğŸ“</div>
          <div>
            <h1 class="app-name">å­¦ç”Ÿä¿¡æ¯åŠ©æ‰‹</h1>
            <p class="app-version">v1.3.0</p>
          </div>
        </div>
      </div>

      <div class="card intro-card">
        <h2 class="section-title">ğŸ“– é¡¹ç›®ç®€ä»‹</h2>
        <p class="intro-text">
          ã€Œå­¦ç”Ÿä¿¡æ¯åŠ©æ‰‹ã€æ˜¯ä¸€æ¬¾è½»é‡çº§çš„ä¸ªäººå­¦ä¸šä¿¡æ¯ç®¡ç†å·¥å…·ï¼Œä¸“ä¸ºåœ¨æ ¡å­¦ç”Ÿæˆ–æ¯•ä¸šç”Ÿè®¾è®¡ã€‚æ”¯æŒè®°å½•å­¦ç±ã€å­¦å†ã€å­¦ä½ç­‰å…³é”®ä¿¡æ¯ï¼Œå¹¶å¯åœ¨å¤šè®¾å¤‡é—´é€šè¿‡æ‰‹åŠ¨åŒæ­¥ï¼ˆå¦‚æˆªå›¾æˆ–ç¬”è®°ï¼‰è¿›è¡Œå¤‡ä»½ã€‚
        </p>
      </div>

      <!-- å¯æŠ˜å å†…å®¹ -->
      <van-collapse v-model="activeName" accordion>
        <!-- ä½¿ç”¨è¯´æ˜ -->
        <van-collapse-item name="usage" title="ğŸš€ ä½¿ç”¨è¯´æ˜">
          <div class="steps">
            <div class="step" v-for="(step, i) in steps" :key="i">
              <span class="step-num">{{ i + 1 }}</span>
              <span class="step-text">{{ step }}</span>
            </div>
          </div>
        </van-collapse-item>

        <!-- æ³¨æ„äº‹é¡¹ -->
        <van-collapse-item name="notes" title="âš ï¸ æ³¨æ„äº‹é¡¹">
          <ul class="note-list">
            <li>æ•°æ®é€šè¿‡ <code>localStorage</code> ä¿å­˜ï¼Œåˆ·æ–°é¡µé¢ä¸ä¼šä¸¢å¤±ã€‚</li>
            <li>è¯·å‹¿åœ¨å…¬å…±æˆ–å…±äº«è®¾å¤‡ä¸Šä½¿ç”¨ï¼Œé¿å…ä»–äººæŸ¥çœ‹æ‚¨çš„ä¿¡æ¯ã€‚</li>
            <li>ä¸åŒéƒ¨ç½²ç«™ç‚¹ï¼ˆNetlify / Vercel / Cloudflare Pagesï¼‰æ•°æ®<strong>ä¸äº’é€š</strong>ï¼Œå»ºè®®å›ºå®šä½¿ç”¨ä¸€ä¸ªåŸŸåã€‚</li>
            <li>å¦‚éœ€æ¸…é™¤æ‰€æœ‰æ•°æ®ï¼Œè¯·åœ¨æµè§ˆå™¨ä¸­æ‰‹åŠ¨æ¸…é™¤è¯¥ç«™ç‚¹çš„æœ¬åœ°å­˜å‚¨ã€‚</li>
            <li><strong>è®¿é—®é™åˆ¶è¯´æ˜</strong>ï¼š
              <ul class="sub-list">
                <li><strong>Netlify</strong>ï¼šæœ‰æµé‡é…é¢é™åˆ¶ï¼Œé«˜å³°æœŸå¯èƒ½æ— æ³•è®¿é—®ï¼›</li>
                <li><strong>Vercel</strong>ï¼šä¸»è¦é¢å‘å¢ƒå¤–ç½‘ç»œï¼Œå›½å†…è®¿é—®å¯èƒ½ä¸ç¨³å®šï¼›</li>
                <li><strong>Cloudflare Pages</strong>ï¼šå›½å†…è®¿é—®æ›´ç¨³å®šï¼Œæ¨èä¼˜å…ˆä½¿ç”¨ã€‚</li>
              </ul>
            </li>
          </ul>
        </van-collapse-item>

        <!-- å¸¸è§é—®é¢˜ -->
        <van-collapse-item name="faq" title="â“ å¸¸è§é—®é¢˜">
          <van-cell v-for="(faq, i) in faqs" :key="i" :title="faq.q" :value="faq.a" />
        </van-collapse-item>

        <!-- å½“å‰ç«™ç‚¹ -->
        <van-collapse-item name="sites" title="ğŸŒ å½“å‰å¯ç”¨ç«™ç‚¹">
          <div class="domain-grid">
            <a v-for="site in sites" :key="site.url" :href="site.url.trim()" target="_blank" class="domain-card">
              {{ site.name }}
              <van-icon name="arrow" size="14" class="domain-arrow" />
            </a>
          </div>
        </van-collapse-item>

        <!-- æ›´æ–°æ—¥å¿— -->
        <van-collapse-item name="changelog" title="ğŸ“ˆ æœ€è¿‘æ›´æ–°">
          <div class="log-entry" v-for="log in recentLogs" :key="log.version">
            <div class="log-header">
              <span class="log-version">v{{ log.version }}</span>
              <span class="log-date">{{ formatDate(log.date) }}</span>
            </div>
            <ul class="log-list">
              <li v-for="(item, idx) in log.changes" :key="idx">
                <van-tag :type="getTagType(item.type)" size="mini" round>
                  {{ getTagText(item.type) }}
                </van-tag>
                {{ item.desc }}
              </li>
            </ul>
          </div>
        </van-collapse-item>
      </van-collapse>

      <!-- è”ç³»ä¸åé¦ˆï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ -->
      <div class="card feedback-card">
        <h2 class="section-title">ğŸ“¬ è”ç³»ä¸åé¦ˆ</h2>
        <div class="feedback-actions">
          <van-button type="primary" block @click="openFeedbackForm">ğŸ“ å¡«å†™åé¦ˆè¡¨å•</van-button>
          <van-button plain type="info" block @click="showConfirmDialog" style="margin-top: 12px">
            ğŸ’¬ è”ç³»å¼€å‘è€…ï¼ˆå¾®ä¿¡ï¼‰
          </van-button>
        </div>
      </div>

      <div class="footer">Â© {{ new Date().getFullYear() }} å­¦ç”Ÿä¿¡æ¯åŠ©æ‰‹</div>
    </div>

    <!-- è”ç³»ç¡®è®¤å¯¹è¯æ¡† -->
    <van-dialog v-model:show="showDialog" title="è”ç³»å¼€å‘è€…" show-cancel-button confirm-button-text="æ˜¾ç¤ºäºŒç»´ç "
      cancel-button-text="å–æ¶ˆ" @confirm="showQRCode" @cancel="showDialog = false">
      <p class="dialog-text">æ˜¯å¦æŸ¥çœ‹å¾®ä¿¡è”ç³»äºŒç»´ç ï¼Ÿ</p>
    </van-dialog>

    <!-- äºŒç»´ç å¼¹å±‚ -->
    <van-overlay :show="showQR" @click="showQR = false">
      <div class="qr-container" @click.stop>
        <van-image :src="wechatQRCode" width="220" height="220" fit="contain" radius="12" />
        <div class="qr-tip">é•¿æŒ‰ä¿å­˜äºŒç»´ç ï¼Œå¾®ä¿¡æ‰«ç è”ç³»</div>
      </div>
    </van-overlay>
  </div>
</template>

<script setup>
import { ref } from 'vue'
import { useRouter } from 'vue-router'


const router = useRouter()
const FEEDBACK_FORM_URL = 'https://www.wjx.cn/vm/YxTypie.aspx#'
const wechatQRCode = '/wechat-qr.png'

const activeName = ref('usage')
const goBack = () => {
  if (window.history.length > 1) {
    router.go(-1)
  } else {
    router.push('/')
  }
}

const openFeedbackForm = () => {
  window.open(FEEDBACK_FORM_URL, '_blank')
}

// é»˜è®¤å±•å¼€ï¼šä»…â€œä½¿ç”¨è¯´æ˜â€
const activeNames = ref(['usage'])

// ç«™ç‚¹åˆ—è¡¨
const sites = [
  { name: 'Netlify éƒ¨ç½²', url: 'https://xuexin.netlify.app/' },
  { name: 'Vercel éƒ¨ç½²', url: 'https://xuexin-dusky.vercel.app/' },
  { name: 'Cloudflare Pages', url: 'https://xuexin.pages.dev/#/' }
]

// ä½¿ç”¨æ­¥éª¤
const steps = [
  'åœ¨ã€Œæˆ‘çš„ã€é¡µé¢ç‚¹å‡»å¤´åƒï¼Œç¼–è¾‘ä¸ªäººä¿¡æ¯æˆ–ä¸Šä¼ å¤´åƒ',
  'åœ¨ã€Œæˆ‘çš„ã€â†’â€œé€€å‡ºç™»å½•â€åŒºåŸŸï¼Œç¼–è¾‘æ•™è‚²ç›¸å…³ä¿¡æ¯',
  'å¡«å†™å®Œæˆåç‚¹å‡»â€œä¿å­˜â€ï¼Œæ•°æ®å°†è‡ªåŠ¨å­˜å…¥æµè§ˆå™¨',
  'ä¸‹æ¬¡è®¿é—®åŒä¸€åŸŸåæ—¶ï¼Œä¿¡æ¯ä¼šè‡ªåŠ¨åŠ è½½'
]

// å¸¸è§é—®é¢˜
const faqs = [
  { q: 'æ•°æ®ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨å—ï¼Ÿ', a: 'ä¸ä¼šã€‚æ‰€æœ‰æ•°æ®ä»…ä¿å­˜åœ¨æ‚¨å½“å‰æµè§ˆå™¨çš„ localStorage ä¸­ï¼Œå®Œå…¨æœ¬åœ°åŒ–ã€‚' },
  { q: 'æ¢åŸŸååæ•°æ®è¿˜åœ¨å—ï¼Ÿ', a: 'ä¸åœ¨ã€‚ä¸åŒåŸŸåè¢«è§†ä¸ºä¸åŒç«™ç‚¹ï¼Œæµè§ˆå™¨æ•°æ®éš”ç¦»ï¼Œæ— æ³•å…±äº«ã€‚' },
  { q: 'å¦‚ä½•æ¸…é™¤æ‰€æœ‰ä¿¡æ¯ï¼Ÿ', a: 'åœ¨æµè§ˆå™¨è®¾ç½®ä¸­æ¸…é™¤è¯¥ç«™ç‚¹çš„ Cookie ä¸æœ¬åœ°å­˜å‚¨å³å¯ã€‚' },
  { q: 'æ”¯æŒæ‰‹æœºä½¿ç”¨å—ï¼Ÿ', a: 'æ”¯æŒï¼é¡µé¢å·²é€‚é…ç§»åŠ¨ç«¯ï¼Œå¯åœ¨æ‰‹æœºæµè§ˆå™¨ä¸­æ­£å¸¸ä½¿ç”¨ã€‚' }
]

// æ›´æ–°æ—¥å¿—
const recentLogs = [
  {
    version: '1.3.0',
    date: '2025-10-25',
    changes: [
      { type: 'feature', desc: 'è¡¥å……å­¦ç±ã€å­¦å†ã€å­¦ä½ç­‰å‰©ä½™é¡µé¢' },
      { type: 'perf', desc: 'ä¼˜åŒ–é¡µé¢åŠ è½½æ€§èƒ½ï¼Œæå‡å“åº”é€Ÿåº¦' },
      { type: 'improvement', desc: 'å®Œå–„è¡¨å•ä¿®æ”¹æ—¶çš„æ’åºé€»è¾‘ä¸å†²çªå¤„ç†' }
    ]
  },
  {
    version: '1.2.0',
    date: '2025-10-24',
    changes: [
      { type: 'feature', desc: 'æ–°å¢ä¿¡æ¯ä¿®æ”¹åŠŸèƒ½å…¥å£' },
      { type: 'improvement', desc: 'ä¼˜åŒ–è¡¨å•ç¼–è¾‘ä½“éªŒä¸æ•°æ®åŒæ­¥æœºåˆ¶' }
    ]
  }
]

// å·¥å…·å‡½æ•°
const formatDate = (dateStr) => {
  const d = new Date(dateStr)
  return `${d.getMonth() + 1}æœˆ${d.getDate()}æ—¥`
}

const getTagText = (type) => {
  const map = { feature: 'æ–°å¢', improvement: 'ä¼˜åŒ–', fix: 'ä¿®å¤', perf: 'æ€§èƒ½' }
  return map[type] || 'æ›´æ–°'
}

const getTagType = (type) => {
  const map = { feature: 'success', improvement: 'primary', fix: 'danger', perf: 'warning' }
  return map[type] || 'default'
}

// å¾®ä¿¡è”ç³»
const showDialog = ref(false)
const showQR = ref(false)

const showConfirmDialog = () => {
  showDialog.value = true
}

const showQRCode = () => {
  showDialog.value = false
  showQR.value = true
}
</script>

<style scoped>
.intro-card {
  margin-bottom: 16px;
}

.intro-text {
  font-size: 14px;
  color: #334155;
  line-height: 1.6;
  margin: 0;
}

.about-guide-page {
  padding-top: 46px;
  min-height: 100vh;
  background-color: #f8fafc;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

.content {
  padding: 16px;
}

.card {
  background: white;
  border-radius: 16px;
  padding: 20px;
  margin-bottom: 20px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
}

.app-card {
  margin-bottom: 16px;
}

.feedback-card {
  margin-top: 16px;
}

.app-header {
  display: flex;
  align-items: center;
  gap: 16px;
}

.app-icon {
  font-size: 32px;
  color: #3b82f6;
}

.app-name {
  font-size: 20px;
  font-weight: 700;
  color: #1e293b;
  margin: 0;
}

.app-version {
  font-size: 14px;
  color: #64748b;
  margin-top: 4px;
}

.section-title {
  font-size: 16px;
  font-weight: 600;
  color: #1e293b;
  margin: 0 0 16px;
}

/* æ­¥éª¤ */
.steps {
  display: flex;
  flex-direction: column;
  gap: 14px;
}

.step {
  display: flex;
  align-items: flex-start;
  gap: 12px;
}

.step-num {
  flex: 0 0 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #dbeafe;
  color: #1d4ed8;
  border-radius: 50%;
  font-weight: bold;
  font-size: 14px;
}

.step-text {
  flex: 1;
  font-size: 14px;
  color: #334155;
  line-height: 1.5;
}

/* æ³¨æ„äº‹é¡¹ */
.note-list {
  padding-left: 20px;
  margin: 0;
  font-size: 14px;
  color: #334155;
  line-height: 1.7;
}

.note-list li {
  margin-bottom: 10px;
}

.sub-list {
  margin-top: 8px;
  padding-left: 20px;
  font-size: 13px;
  color: #64748b;
}

.sub-list li {
  margin-bottom: 6px;
}

code {
  background: #f1f5f9;
  padding: 2px 4px;
  border-radius: 4px;
  font-size: 13px;
}

/* ç«™ç‚¹å¡ç‰‡ */
.domain-grid {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.domain-card {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  background: #f8fafc;
  border-radius: 12px;
  text-decoration: none;
  color: #1e293b;
  font-size: 14px;
  transition: background 0.2s;
}

.domain-card:hover {
  background: #eef2ff;
}

.domain-arrow {
  color: #94a3b8;
}

/* æ›´æ–°æ—¥å¿— */
.log-entry {
  margin-bottom: 20px;
}

.log-header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 10px;
  font-size: 14px;
}

.log-version {
  font-weight: 600;
  color: #1e293b;
}

.log-date {
  color: #94a3b8;
}

.log-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.log-list li {
  display: flex;
  align-items: flex-start;
  gap: 8px;
  padding: 6px 0;
  font-size: 14px;
  color: #334155;
  line-height: 1.5;
}

.log-list li .van-tag {
  margin-top: 2px;
}

/* åé¦ˆæŒ‰é’® */
.feedback-actions {
  margin-top: 12px;
}

/* äºŒç»´ç  */
.qr-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: white;
  padding: 24px;
  border-radius: 16px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  z-index: 1000;
}

.qr-tip {
  margin-top: 12px;
  font-size: 14px;
  color: #64748b;
  text-align: center;
  line-height: 1.4;
}

.dialog-text {
  text-align: center;
  padding: 16px;
  color: #334155;
}

.footer {
  text-align: center;
  font-size: 12px;
  color: #94a3b8;
  margin-top: 24px;
  padding-top: 16px;
  border-top: 1px solid #e2e8f0;
}
</style>